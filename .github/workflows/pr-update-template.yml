name: PR - Update Template

on:
  pull_request:
    types: [opened]

jobs:
  update-template:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read

    steps:
      - name: Update PR description with PR number
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            const prBranch = context.payload.pull_request.head.ref;
            const currentBody = context.payload.pull_request.body || '';

            // Replace [PR_NUMBER] with actual PR number and [PR_BRANCH] with branch name
            let updatedBody = currentBody.replace(/\[PR_NUMBER\]/g, prNumber);
            updatedBody = updatedBody.replace(/\[PR_BRANCH\]/g, prBranch);

            // Only update if there were replacements made
            if (updatedBody !== currentBody) {
              await github.rest.pulls.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: prNumber,
                body: updatedBody
              });

              console.log(`Updated PR #${prNumber} description with PR number and branch name`);
            } else {
              console.log(`No [PR_NUMBER] or [PR_BRANCH] placeholders found in PR #${prNumber}`);
            }