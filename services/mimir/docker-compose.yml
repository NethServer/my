# Alerting Infrastructure - Dedicated VM deployment
#
# Run on a separate server from the main application stack.
#
# üöÄ Start: docker-compose -f mimir/docker-compose.yml up -d
# üõë Stop:  docker-compose -f mimir/docker-compose.yml down
#
# üåê Service URLs:
#   - Mimir:  http://localhost:19009
#
# ‚öôÔ∏è Required environment variables (set in mimir/.env or shell):
#   MIMIR_S3_ENDPOINT, MIMIR_S3_ACCESS_KEY, MIMIR_S3_SECRET_KEY
#   MIMIR_S3_ALERTMANAGER_BUCKET

version: '3.8'

services:
  # =============================================================================
  # MIMIR (single node)
  # =============================================================================

  mimir:
    build:
      context: .
      dockerfile: Containerfile
    container_name: ${COMPOSE_PROJECT_NAME:-metrics}-mimir
    restart: unless-stopped
    environment:
      PORT: 9009
      MIMIR_S3_ENDPOINT: ${MIMIR_S3_ENDPOINT}
      MIMIR_S3_ACCESS_KEY: ${MIMIR_S3_ACCESS_KEY}
      MIMIR_S3_SECRET_KEY: ${MIMIR_S3_SECRET_KEY}
      MIMIR_S3_ALERTMANAGER_BUCKET: ${MIMIR_S3_ALERTMANAGER_BUCKET}
    ports:
      - "19009:9009"
    networks:
      - metrics-network

# =============================================================================
# NETWORKS
# =============================================================================
networks:
  metrics-network:
    driver: bridge
    name: ${COMPOSE_PROJECT_NAME:-metrics}-network
